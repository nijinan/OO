<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="UTF-8" />
    </head>
    <body>
    	<div id="userInfo">
    	客户ID<input type="text" name="userid" id="userid"><br />
    	<ol id="message"></ol>
    	</div>
        <ol id="menu">
            
        </ol>
        <ol id="recommandations">
        </ol>
        <script src="/js/jquery-2.1.0.min.js"></script>
        <script src="/js/name.js"></script>
        <script>
            function setmenu(a) {
            	var obj = JSON.parse("["+a+"]");
                for (i=0;i<a.length;i++) {
                    $("#menu"+i).val(obj[i]);
                }
            };
        
            function submitmenu() {
                userid=$("#userid").val();
                a=new Array();
                for (i=0;i<category.length;i++) {
                    a[i]=parseInt($("#menu"+i).val());
                }
                console.log(a,userid);
               	var url = "/api/customer/new";
               	var param = {
               		"id" : userid,
               		"order" : JSON.stringify(a)
               	};
                $.post(url, param, function(data) {
                    console.log(data);
                    if (data != "Error") {
                    	$("#message").append($("<li/>").html("您的订单已接收，您需支付" + data + "元"))
                    }
                });
            };
        
            //we should download name array here
            //load menu
            $(function() {
            for (i=0;i<category.length;i++) {
                $("#menu").append($("<li/>").append(category[i]).append($("<select/>").attr({"id":"menu"+i})));
                for (j=0;j<menuname[i].length;j++)
                    $("#menu"+i).append($("<option/>").attr({"value":j}).html(menuname[i][j]));
            }
            $("#menu").append($("<button/>").attr({"id":"submitMenu"}).html("下单"));
            $("#submitMenu").bind("click", submitmenu);
            
            //load chef recommandation
            $.get("/api/customer/chef",function(data) {
                menurecommand=JSON.parse(data);
                for (i=0;i<menurecommand.length;i++) {
                    $("#recommandations").append($("<li/>").attr({"id":"recommand"+i}).html(menurecommand[i].name));
                    $("#recommand"+i).append($("<ul/>").attr({"id":"recommandul"+i}));
                    for (j=0;j<menurecommand[i].recipe.length;j++)
                        $("#recommandul"+i).append($("<li/>").html(menuname[j][menurecommand[i].recipe[j]]));
                    $("#recommand"+i).append($("<button/>")
                                              .attr({"onclick":"setmenu("+JSON.stringify(menurecommand[i].recipe)+")"})
                                              .html("尝尝这个！")
                    );
                }
            });
            });
        </script>
    </body>
</html>